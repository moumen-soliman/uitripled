module.exports=[727279,a=>{"use strict";var b=a.i(2659),c=Object.create,d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,i=(a,b)=>function(){return b||(0,a[f(a)[0]])((b={exports:{}}).exports,b),b.exports},j=(a,b,i)=>(i=null!=a?c(g(a)):{},((a,b,c,g)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let c of f(b))h.call(a,c)||void 0===c||d(a,c,{get:()=>b[c],enumerable:!(g=e(b,c))||g.enumerable});return a})(!b&&a&&a.__esModule?i:d(i,"default",{value:a,enumerable:!0}),a)),k=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot "+c)},l=(a,b,c)=>(k(a,b,"read from private field"),c?c.call(a):b.get(a)),m=(a,b,c)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,c)},n=(a,b,c,d)=>(k(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),o=(a,b,c)=>(k(a,b,"access private method"),c),p=i({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/pad.js"(a,b){b.exports=function(a,b){var c="000000000"+a;return c.substr(c.length-b)}}}),q=i({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/fingerprint.browser.js"(a,b){var c=p(),d=Object.keys(self).length,e=c(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+d.toString(36),4);b.exports=function(){return e}}}),r=i({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/getRandomValue.browser.js"(a,b){var c,d="undefined"!=typeof self&&self.crypto;d?c=function(){return Math.abs(d.getRandomValues(new Uint32Array(1))[0]/0xffffffff)}:c=Math.random,b.exports=c}}),s=i({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/index.js"(a,b){var c=q(),d=p(),e=r(),f=0;function g(){return d((1679616*e()|0).toString(36),4)}function h(){return f=f<1679616?f:0,++f-1}function i(){return"c"+new Date().getTime().toString(36)+d(h().toString(36),4)+c()+(g()+g())}i.slug=function(){var a=new Date().getTime().toString(36),b=h().toString(36).slice(-4),d=c().slice(0,1)+c().slice(-1),e=g().slice(-2);return a.slice(-2)+b+d+e},i.isCuid=function(a){return"string"==typeof a&&!!a.startsWith("c")},i.isSlug=function(a){if("string"!=typeof a)return!1;var b=a.length;return!!(b>=7)&&!!(b<=10)},i.fingerprint=c,b.exports=i}}),t=i({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/createDeferredExecutor.js"(a){Object.defineProperty(a,"__esModule",{value:!0}),a.createDeferredExecutor=void 0,a.createDeferredExecutor=function(){let a=(b,c)=>{a.state="pending",a.resolve=c=>"pending"!==a.state?void 0:(a.result=c,b(c instanceof Promise?c:Promise.resolve(c).then(b=>(a.state="fulfilled",b)))),a.reject=b=>{if("pending"===a.state)return queueMicrotask(()=>{a.state="rejected"}),c(a.rejectionReason=b)}};return a}}}),u=i({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/DeferredPromise.js"(a){Object.defineProperty(a,"__esModule",{value:!0}),a.DeferredPromise=void 0;var b=t();a.DeferredPromise=class extends Promise{#a;resolve;reject;constructor(a=null){const c=(0,b.createDeferredExecutor)();super((b,d)=>{c(b,d),a?.(c.resolve,c.reject)}),this.#a=c,this.resolve=this.#a.resolve,this.reject=this.#a.reject}get state(){return this.#a.state}get rejectionReason(){return this.#a.rejectionReason}then(a,b){return this.#b(super.then(a,b))}catch(a){return this.#b(super.catch(a))}finally(a){return this.#b(super.finally(a))}#b(a){return Object.defineProperties(a,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}}}}),v=i({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/index.js"(a){var b=a&&a.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),c=a&&a.__exportStar||function(a,c){for(var d in a)"default"===d||Object.prototype.hasOwnProperty.call(c,d)||b(c,a,d)};Object.defineProperty(a,"__esModule",{value:!0}),c(t(),a),c(u(),a)}}),w=i({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/MemoryLeakError.js"(a){Object.defineProperty(a,"__esModule",{value:!0}),a.MemoryLeakError=void 0,a.MemoryLeakError=class extends Error{emitter;type;count;constructor(a,b,c){super(`Possible EventEmitter memory leak detected. ${c} ${b.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=a,this.type=b,this.count=c,this.name="MaxListenersExceededWarning"}}}}),x=i({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/Emitter.js"(a){let b;Object.defineProperty(a,"__esModule",{value:!0}),a.Emitter=void 0;var c,e,f,g,h,i,j,k,p,q,r,s,t=w(),u=class{constructor(){m(this,h),m(this,j),m(this,p),m(this,r),m(this,e,void 0),m(this,f,void 0),m(this,g,void 0),n(this,e,new Map),n(this,f,u.defaultMaxListeners),n(this,g,!1)}static listenerCount(a,b){return a.listenerCount(b)}setMaxListeners(a){return n(this,f,a),this}getMaxListeners(){return l(this,f)}eventNames(){return Array.from(l(this,e).keys())}emit(a,...b){let c=o(this,h,i).call(this,a);return c.forEach(a=>{a.apply(this,b)}),c.length>0}addListener(a,b){o(this,r,s).call(this,"newListener",a,b);let c=o(this,h,i).call(this,a).concat(b);return l(this,e).set(a,c),l(this,f)>0&&this.listenerCount(a)>l(this,f)&&!l(this,g)&&(n(this,g,!0),console.warn(new t.MemoryLeakError(this,a,this.listenerCount(a)))),this}on(a,b){return this.addListener(a,b)}once(a,b){return this.addListener(a,o(this,p,q).call(this,a,b))}prependListener(a,b){let c=o(this,h,i).call(this,a);if(c.length>0){let d=[b].concat(c);l(this,e).set(a,d)}else l(this,e).set(a,c.concat(b));return this}prependOnceListener(a,b){return this.prependListener(a,o(this,p,q).call(this,a,b))}removeListener(a,b){let c=o(this,h,i).call(this,a);return c.length>0&&(o(this,j,k).call(this,c,b),l(this,e).set(a,c),o(this,r,s).call(this,"removeListener",a,b)),this}off(a,b){return this.removeListener(a,b)}removeAllListeners(a){return a?l(this,e).delete(a):l(this,e).clear(),this}listeners(a){return Array.from(o(this,h,i).call(this,a))}listenerCount(a){return o(this,h,i).call(this,a).length}rawListeners(a){return this.listeners(a)}};e=new WeakMap,f=new WeakMap,g=new WeakMap,h=new WeakSet,i=function(a){return l(this,e).get(a)||[]},j=new WeakSet,k=function(a,b){let c=a.indexOf(b);return c>-1&&a.splice(c,1),[]},p=new WeakSet,q=function(a,b){let c=(...d)=>{this.removeListener(a,c),b.apply(this,d)};return c},r=new WeakSet,s=function(a,b,c){this.emit(a,b,c)},(b="symbol"!=typeof(c="defaultMaxListeners")?c+"":c)in u?d(u,b,{enumerable:!0,configurable:!0,writable:!0,value:10}):u[b]=10,a.Emitter=u}}),y=i({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/index.js"(a){var b=a&&a.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),c=a&&a.__exportStar||function(a,c){for(var d in a)"default"===d||Object.prototype.hasOwnProperty.call(c,d)||b(c,a,d)};Object.defineProperty(a,"__esModule",{value:!0}),c(x(),a),c(w(),a)}}),z=j(s()),A=/(%?)(%([sdjo]))/g;function B(a,...b){if(0===b.length)return a;let c=0,d=a.replace(A,(a,d,e,f)=>{let g=function(a,b){switch(b){case"s":return a;case"d":case"i":return Number(a);case"j":return JSON.stringify(a);case"o":{if("string"==typeof a)return a;let b=JSON.stringify(a);if("{}"===b||"[]"===b||/^\[object .+?\]$/.test(b))return a;return b}}}(b[c],f);return d?a:(c++,g)});return c<b.length&&(d+=` ${b.slice(c).join(" ")}`),d=d.replace(/%{2,2}/g,"%")}var C=class extends Error{constructor(a,...b){super(a),this.message=a,this.name="Invariant Violation",this.message=B(a,...b),function(a){if(!a.stack)return;let b=a.stack.split("\n");b.splice(1,2),a.stack=b.join("\n")}(this)}},D=(a,b,...c)=>{if(!a)throw new C(b,...c)};D.as=(a,b,c,...d)=>{if(!b)throw null!=a.prototype.name?new a(B(c,d)):a(B(c,d))};var E=j(v()),F=window.localStorage.CSB_EMULATOR_DEBUG,G="\x1b[36;1m",H={preview:"\x1b[33;1m",emulator:"\x1b[35;1m",runtime:G,bridge:"\x1b[34m","runtime:worker":G};function I(a){return function(b,...c){if("true"===F){let d=b.replace(/\[.+\]:/,"");console.debug(`${H[a]}${a}:${b.includes("sender")?`\x1b[32;1msender`:b.includes("receiver")?`\x1b[31mreceiver`:""}\x1b[0m:${d}`,...c)}}}var J=I("emulator"),K=class{constructor(a){this.target=a,this.emitter=new EventTarget,this.channel=new MessageChannel,this.receiverPort=this.channel.port1;const b=new E.DeferredPromise,c=a=>{"internal/ready"===a.data.type&&(J("[message-sender]: runtime is ready"),b.resolve())};window.addEventListener("message",c),b.then(()=>{window.removeEventListener("message",c)}),this.receiverReadyPromise=b,this.receiverPort.onmessage=a=>{let b=a.data;null!=b.type&&(J('[message-sender]: emitting "%s" event...',b.type,b.payload),this.emitter.dispatchEvent(new MessageEvent(b.type,{data:b.payload})))}}emitter;channel;receiverPort;receiverReadyPromise;async handshake(){let a=new E.DeferredPromise;await this.receiverReadyPromise,J("[message-sender]: sending handshake"),this.target.postMessage({type:"internal/handshake"},"*",[this.channel.port2]),this.on("internal/handshake/done",()=>{a.resolve(),clearTimeout(b)});let b=setTimeout(()=>{a.reject(Error("MessageSender: Handshake timeout"))},5e3);return a}on(a,b,c){J('[message-sender]: add listener "%s"',a),this.emitter.addEventListener(a,a=>{a instanceof MessageEvent&&b(a)},c)}off(a,b,c){this.emitter.removeEventListener(a,b,c)}async send(a,...b){let c=new E.DeferredPromise,d=(0,z.default)(),e=b[0]||{};J('[message-sender]: send "%s" (%s)',a,d,e),this.receiverPort.postMessage({type:a,payload:{operationId:d,payload:e}}),J('[message-sender]: adding done listener for "%s" (%s)',a,d);let f=b=>{let{data:e}=b;if(e.operationId===d){let b=e.listenerPayload||{};J('[message-sender]: resolving "%s (%s) promise!',a,d),c.resolve({...b,operationId:e.operationId})}},g=b=>{let{data:e}=b;e.operationId===d&&(J('[message-sender]: rejecting "%s (%s) promise!',a,d),c.reject(e.error))};return this.on("internal/operation/done",f),this.on("internal/operation/failed",g),c.finally(()=>{this.emitter.removeEventListener("internal/operation/done",f),this.emitter.removeEventListener("internal/operation/failed",g)})}},L=j(v()),M=j(s()),N=class{constructor(a){this.channel=a}async init(a){await this.channel.send("fs/init",{files:a})}async readFile(a,b){let c=await this.channel.send("fs/readFile",{path:a,encoding:b}).catch(b=>{throw Error(B('Failed to read file at path "%s"',a),{cause:b})});if(!c)throw Error("File not found");return c.data}async writeFile(a,b,c){let d,e=!1;"object"==typeof c?(d=c.encoding,e=!!c.recursive):"string"==typeof c&&(d=c),await this.channel.send("fs/writeFile",{path:a,content:b,encoding:d,recursive:e}).catch(b=>{throw Error(B('Failed to write file at path "%s"',a),{cause:b})})}async readdir(a){let b=await this.channel.send("fs/readdir",{path:a}).catch(b=>{throw Error(B('Failed to read directory at path "%s"',a),{cause:b})});if(!b)throw Error("Directory not found");return b.data}async mkdir(a,b){let c=!!b?.recursive;await this.channel.send("fs/mkdir",{path:a,recursive:c}).catch(b=>{throw Error(B('Failed to make directory at path "%s"',a),{cause:b})})}async stat(a){let b=await this.channel.send("fs/stat",{path:a}).catch(b=>{throw Error(B('Failed to stat file at path "%s"',a),{cause:b})});if(!b)throw Error("File not found");return b.data}async rm(a,b){let{force:c,recursive:d}=b||{};await this.channel.send("fs/rm",{path:a,force:c,recursive:d}).catch(b=>{throw Error(B('Failed to remove file at path "%s"',a),{cause:b})})}async watch(a,b,c){let d=(0,M.default)();return await this.channel.send("fs/watch",{watcherId:d,includes:a,excludes:b}),this.channel.on("fs/watch-event",({data:a})=>{if(a.watcherId===d&&c){let b={...a};delete b.watcherId,c(b)}}),{dispose:()=>this.channel.send("fs/unwatch",{watcherId:d})}}},O=j(y()),P=class{constructor(a){this.channel=a}create(){return new Q(this.channel)}},Q=class{constructor(a){this.channel=a,this.state="running",this.stdout=new O.Emitter,this.stderr=new O.Emitter,this.stdin={write:a=>{if(!this.id)throw Error("Failed to write to stdin, no process is currently running");return this.channel.send("shell/stdin",{data:a,workerId:this.id})}},this.forwardStdEvents()}id;state;stdout;stderr;stdin;forwardStdEvents(){this.channel.on("worker/tty",a=>{let{data:b}=a;if(b.workerId===this.id)switch(b.payload.type){case"out":this.stdout.emit("data",b.payload.data);break;case"err":this.stderr.emit("data",b.payload.data)}})}async runCommand(a,b,c={}){D(!this.id,'Failed to run "runCommand" on a ShellProcess: there is already a process running.');let d=await this.channel.send("shell/runCommand",{command:a,args:b,options:c});return D(d,'Failed to run "runCommand" on a ShellProcess: was not able to retrieve a running process.'),this.id=d.id,this.state="running",d}async on(a,b){switch(a){case"progress":return void this.channel.on("worker/progress",({data:a})=>{b(a.status)});case"exit":return void this.channel.on("worker/exit",({data:a})=>{a.workerId===this.id&&b(a.exitCode,a.error)})}}async kill(){D(this.id,'Failed to run "kill" on a ShellProcess: there is no process running. Did you forget to run it?'),this.state="idle",await this.channel.send("shell/exit",{id:this.id}).catch(a=>{throw Error(B('Failed to kill shell with ID "%s"',this.id),{cause:a})}),this.id=void 0}},R=j(v()),S=class{constructor(a){this.channel=a}async waitFor(a,b,c=2e4){let d=new R.DeferredPromise,e=setTimeout(()=>{d.reject()},c),f=await this.channel.send("preview/get/info",a).catch(b=>{d.reject(Error(B('Failed to look up preview information for shell ID "%s" (port: %d)',a.sourceShellId,a.port)))}),g=f&&b(f);return g&&d.resolve({url:f.url,port:f.port,sourceShellId:f.sourceShellId}),this.channel.on("preview/port/ready",({data:a})=>{!g&&b(a)&&d.resolve({url:a.url,port:a.port,sourceShellId:a.sourceShellId})}),d.finally(()=>{clearTimeout(e)})}async getByShellId(a,b){return this.waitFor({sourceShellId:a},b=>b.sourceShellId===a,b).catch(b=>{throw Error(B('Failed to get shell by ID "%s"',a),{cause:b})})}async waitForPort(a,b){return this.waitFor({port:a},b=>b.port===a,b).catch(b=>{throw Error(B("Failed to await port %d",a),{cause:b})})}},T=I("emulator"),U=class{constructor(a){this.options=a,D(this.options.iframe,'Failed to create a Nodebox: expected "iframe" argument to be a reference to an <iframe> element but got %j',this.options.iframe),this.url=this.options.runtimeUrl||"https://nodebox-runtime.codesandbox.io",this.isConnected=!1}channel=null;isConnected;url;fileSystemApi=null;shellApi=null;previewApi=null;async connect(){let{iframe:a,cdnUrl:b}=this.options;T("[message-sender]: Connecting to node emulator...");let c=new L.DeferredPromise;this.url||c.reject(Error("Nodebox URL is missing. Did you forget to provide it when creating this Nodebox instance?")),D(a.contentWindow,"Failed to create a MessageChannel with the Nodebox iframe: no content window found"),this.channel=new K(a.contentWindow);let d=new L.DeferredPromise;return a.setAttribute("src",this.url),a.addEventListener("load",()=>{d.resolve()},{once:!0}),a.addEventListener("error",a=>{d.reject(a.error)},{once:!0}),await d,T("[message-sender]: IFrame loaded..."),await this.channel.handshake(),T("[message-sender]: Handshake completed..."),this.channel.send("connect",{cdnUrl:b}),this.channel.on("runtime/ready",()=>{c.resolve()}),c.then(()=>{T("[message-sender]: Connected to runtime..."),this.isConnected=!0})}get fs(){return D(this.isConnected,'Failed to access the File System API: consumer is not connected. Did you forget to run "connect()"?'),this.fileSystemApi||(this.fileSystemApi=new N(this.channel)),this.fileSystemApi}get shell(){return D(this.isConnected,'Failed to access the Shell API: consumer is not connected. Did you forget to run "connect()"?'),this.shellApi||(this.shellApi=new P(this.channel)),this.shellApi}get preview(){return D(this.isConnected,'Failed to access the Preview API: consumer is not connected. Did you forget to run "connect()"?'),this.previewApi||(this.previewApi=new S(this.channel)),this.previewApi}},V=a.i(409134),W=a.i(150484);a.i(402541),a.i(959390);var X=function(a,b){a.style.border="0",a.style.width=b.width||"100%",a.style.height=b.height||"100%",a.style.overflow="hidden",a.allow="cross-origin-isolated"},Y=[{code:(function(a){var b=a.scope,c=window.history.__proto__,d=[],e=0,f=function(a){parent.postMessage({type:"urlchange",url:a,back:e>0,forward:e<d.length-1,channelId:b.channelId},"*")};Object.assign(window.history,{go:function(a){var b=e+a;if(b>=0&&b<=d.length-1){var g=d[e=b],h=g.url,i=g.state;c.replaceState.call(window.history,i,"",h),f(document.location.href),window.dispatchEvent(new PopStateEvent("popstate",{state:i}))}},back:function(){window.history.go(-1)},forward:function(){window.history.go(1)},pushState:function(a,b,g){c.replaceState.call(window.history,a,b,g),d.splice(e+1),d.push({url:g,state:a}),e=d.length-1,f(document.location.href)},replaceState:function(a,b,g){c.replaceState.call(window.history,a,b,g),d[e]={state:a,url:g},f(document.location.href)}}),window.addEventListener("message",function(a){var b=a.data;"urlback"===b.type?history.back():"urlforward"===b.type?history.forward():"refresh"===b.type&&document.location.reload()})}).toString(),id:"historyListener"},{code:"function consoleHook({ scope }) {"+W.c+"\n};",id:"consoleHook"},{code:(function(a){var b,c=a.scope,d=0;function e(){0!==d&&window.parent.postMessage({type:"resize",height:0,codesandbox:!0,channelId:c.channelId},"*"),d=0}e(),new MutationObserver(function(){void 0===b&&(e(),b=setTimeout(function(){b=void 0},300))}).observe(document,{attributes:!0,childList:!0,subtree:!0}),setInterval(e,300)}).toString(),id:"watchResize"}],Z=function(a,b){Y.forEach(function(c){var d,e=c.code,f=c.id;null==(d=a.contentWindow)||d.postMessage({uid:f,type:"INJECT_AND_INVOKE",code:"exports.activate = ".concat(e),scope:{channelId:b}},"*")})},$=function(a){function c(c,d,e){void 0===e&&(e={});var f=a.call(this,c,d,(0,b.h)((0,b.h)({},e),{bundlerURL:e.bundlerURL}))||this;return f._modulesCache=new Map,f.messageChannelId=(0,W.g)(),f._initPromise=null,f.emitter=new W.E,f.manageIframes(c),f.emulator=new U({iframe:f.emulatorIframe,runtimeUrl:f.options.bundlerURL}),f.updateSandbox(d),f}return(0,b.g)(c,a),c.prototype._init=function(a){return(0,b._)(this,void 0,void 0,function(){return(0,b.a)(this,function(b){switch(b.label){case 0:return[4,this.emulator.connect()];case 1:return b.sent(),[4,this.emulator.fs.init(a)];case 2:return b.sent(),[4,this.globalListeners()];case 3:return b.sent(),[2]}})})},c.prototype.compile=function(a){return(0,b._)(this,void 0,void 0,function(){var c,d;return(0,b.a)(this,function(b){switch(b.label){case 0:return b.trys.push([0,5,,6]),this.status="initializing",this.dispatch({type:"start",firstLoad:!0}),this._initPromise||(this._initPromise=this._init(a)),[4,this._initPromise];case 1:return b.sent(),this.dispatch({type:"connected"}),[4,this.createShellProcessFromTask(a)];case 2:return c=b.sent().id,[4,this.createPreviewURLFromId(c)];case 3:return b.sent(),[4,this.setLocationURLIntoIFrame()];case 4:return b.sent(),this.dispatchDoneMessage(),[3,6];case 5:return d=b.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,W.a)(d)}),this.dispatch({type:"done",compilatonError:!0}),[3,6];case 6:return[2]}})})},c.prototype.createShellProcessFromTask=function(a){return(0,b._)(this,void 0,void 0,function(){var c,d,e=this;return(0,b.a)(this,function(f){switch(f.label){case 0:return c=(0,W.r)(a["/package.json"]),this.emulatorCommand=(0,W.b)(c),this.emulatorShellProcess=this.emulator.shell.create(),[4,this.emulatorShellProcess.on("exit",function(a){e.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,b.c)("Error: process.exit(".concat(a,") called."))})})];case 1:return f.sent(),[4,this.emulatorShellProcess.on("progress",function(a){var c,d;if("command_running"===a.state||"starting_command"===a.state){e.dispatch({type:"shell/progress",data:(0,b.h)((0,b.h)({},a),{command:[null==(c=e.emulatorCommand)?void 0:c[0],null==(d=e.emulatorCommand)?void 0:d[1].join(" ")].join(" ")})}),e.status="installing-dependencies";return}e.dispatch({type:"shell/progress",data:a})})];case 2:return f.sent(),this.emulatorShellProcess.stdout.on("data",function(a){e.dispatch({type:"stdout",payload:{data:a,type:"out"}})}),this.emulatorShellProcess.stderr.on("data",function(a){e.dispatch({type:"stdout",payload:{data:a,type:"err"}})}),[4,(d=this.emulatorShellProcess).runCommand.apply(d,this.emulatorCommand)];case 3:return[2,f.sent()]}})})},c.prototype.createPreviewURLFromId=function(a){var c;return(0,b._)(this,void 0,void 0,function(){var d;return(0,b.a)(this,function(b){switch(b.label){case 0:return this.iframePreviewUrl=void 0,[4,this.emulator.preview.getByShellId(a)];case 1:return d=b.sent().url,this.iframePreviewUrl=d+(null!=(c=this.options.startRoute)?c:""),[2]}})})},c.prototype.manageIframes=function(a){var c;if("string"==typeof a){var d=document.querySelector(a);(0,b.n)(d,"The element '".concat(a,"' was not found")),this.iframe=document.createElement("iframe"),null==d||d.appendChild(this.iframe)}else this.iframe=a;X(this.iframe,this.options),(0,b.n)(this.iframe.parentNode,"The given iframe does not have a parent."),this.emulatorIframe=document.createElement("iframe"),this.emulatorIframe.classList.add("sp-bridge-frame"),null==(c=this.iframe.parentNode)||c.appendChild(this.emulatorIframe)},c.prototype.setLocationURLIntoIFrame=function(){return(0,b._)(this,void 0,void 0,function(){return(0,b.a)(this,function(a){switch(a.label){case 0:if(!this.iframePreviewUrl)return[3,2];return[4,function(a,c){return(0,b._)(this,void 0,void 0,function(){var d,e,f;return(0,b.a)(this,function(g){return d=a.contentWindow,(0,b.n)(d,"Failed to await preview iframe: no content window found"),e=0,[2,new Promise(function(d,g){var h=function(){var i=function(){clearTimeout(f),e=20,d(),a.removeEventListener("load",i)};e>=20?g((0,b.c)("Could not able to connect to preview.")):(a.setAttribute("src",c),f=setTimeout(function(){h(),a.removeEventListener("load",i)},9e4),e+=1,a.addEventListener("load",i))};a.addEventListener("error",function(){return g(Error("Iframe error"))}),a.addEventListener("abort",function(){return g(Error("Aborted"))}),h()})]})})}(this.iframe,this.iframePreviewUrl)];case 1:a.sent(),a.label=2;case 2:return[2]}})})},c.prototype.dispatchDoneMessage=function(){this.status="done",this.dispatch({type:"done",compilatonError:!1}),this.iframePreviewUrl&&this.dispatch({type:"urlchange",url:this.iframePreviewUrl,back:!1,forward:!1})},c.prototype.globalListeners=function(){return(0,b._)(this,void 0,void 0,function(){var a=this;return(0,b.a)(this,function(c){switch(c.label){case 0:return window.addEventListener("message",function(b){"PREVIEW_LOADED"===b.data.type&&Z(a.iframe,a.messageChannelId),"urlchange"===b.data.type&&b.data.channelId===a.messageChannelId?a.dispatch({type:"urlchange",url:b.data.url,back:b.data.back,forward:b.data.forward}):b.data.channelId===a.messageChannelId&&a.dispatch(b.data)}),[4,this.emulator.fs.watch(["*"],[".next","node_modules","build","dist","vendor",".config",".vuepress"],function(c){return(0,b._)(a,void 0,void 0,function(){var a,d,e,f,g;return(0,b.a)(this,function(b){switch(b.label){case 0:if(!c)return[2];return d="newPath"in(a=c)?a.newPath:"path"in a?a.path:"",[4,this.emulator.fs.stat(d)];case 1:if("file"!==b.sent().type)return[2,null];b.label=2;case 2:switch(b.trys.push([2,10,,11]),a.type){case"change":case"create":return[3,3];case"remove":return[3,5];case"rename":return[3,6];case"close":return[3,8]}return[3,9];case 3:return[4,this.emulator.fs.readFile(a.path,"utf8")];case 4:return e=b.sent(),this.dispatch({type:"fs/change",path:a.path,content:e}),this._modulesCache.set(a.path,(0,W.w)(e)),[3,9];case 5:return this.dispatch({type:"fs/remove",path:a.path}),this._modulesCache.delete(a.path),[3,9];case 6:return this.dispatch({type:"fs/remove",path:a.oldPath}),this._modulesCache.delete(a.oldPath),[4,this.emulator.fs.readFile(a.newPath,"utf8")];case 7:return f=b.sent(),this.dispatch({type:"fs/change",path:a.newPath,content:f}),this._modulesCache.set(a.newPath,(0,W.w)(f)),[3,9];case 8:return[3,9];case 9:return[3,11];case 10:return g=b.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,W.a)(g)}),[3,11];case 11:return[2]}})})})];case 1:return c.sent(),[2]}})})},c.prototype.restartShellProcess=function(){var a;return(0,b._)(this,void 0,void 0,function(){return(0,b.a)(this,function(b){switch(b.label){case 0:if(!(this.emulatorShellProcess&&this.emulatorCommand))return[3,3];return this.dispatch({type:"start",firstLoad:!0}),this.status="initializing",[4,this.emulatorShellProcess.kill()];case 1:return b.sent(),null==(a=this.iframe)||a.removeAttribute("attr"),this.emulator.fs.rm("/node_modules/.vite",{recursive:!0,force:!0}),[4,this.compile(Object.fromEntries(this._modulesCache))];case 2:b.sent(),b.label=3;case 3:return[2]}})})},c.prototype.updateSandbox=function(a){var b,c=this,d=(0,W.f)(a.files);(null==(b=this.emulatorShellProcess)?void 0:b.state)==="running"?Object.entries(d).forEach(function(a){var b=a[0],d=a[1];c._modulesCache.get(b)&&(0,W.r)(d)===(0,W.r)(c._modulesCache.get(b))||c.emulator.fs.writeFile(b,d,{recursive:!0})}):(this.dispatch({codesandbox:!0,modules:d,template:a.template,type:"compile"}),Object.entries(d).forEach(function(a){var b=a[0],d=a[1];c._modulesCache.set(b,(0,W.w)(d))}))},c.prototype.dispatch=function(a){var c,d;return(0,b._)(this,void 0,void 0,function(){return(0,b.a)(this,function(b){switch(b.label){case 0:switch(a.type){case"compile":return[3,1];case"refresh":return[3,2];case"urlback":case"urlforward":return[3,4];case"shell/restart":return[3,5];case"shell/openPreview":return[3,6]}return[3,7];case 1:return this.compile(a.modules),[3,8];case 2:return[4,this.setLocationURLIntoIFrame()];case 3:return b.sent(),[3,8];case 4:return null==(d=null==(c=this.iframe)?void 0:c.contentWindow)||d.postMessage(a,"*"),[3,8];case 5:return this.restartShellProcess(),[3,8];case 6:return window.open(this.iframePreviewUrl,"_blank"),[3,8];case 7:this.emitter.dispatch(a),b.label=8;case 8:return[2]}})})},c.prototype.listen=function(a){return this.emitter.listener(a)},c.prototype.destroy=function(){this.emulatorIframe.remove(),this.emitter.cleanup()},c}(V.S);a.s(["SandpackNode",()=>$],727279)}];

//# sourceMappingURL=node_modules_%40codesandbox_sandpack-client_dist_clients_node_index_mjs_9aec5dc3._.js.map